<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∂‡•ç‡§∞‡•Ä‡§¶‡§∂‡§Æ‡§π‡§æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§ï‡§µ‡§ö‡§Æ‡•ç - Interactive Study Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e6e3;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: 2.5rem;
            color: #ff6b6b;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #4ecdc4;
            font-style: italic;
            margin-bottom: 10px;
        }

        .subtitle a {
            color: #4ecdc4;
            text-decoration: underline;
        }

        .subtitle a:hover {
            color: #ffbe0b;
        }

        .demo-link {
            color: #ffffff !important;
            text-decoration: underline;
        }

        .demo-link:visited {
            color: #ffffff !important;
        }

        .demo-link:hover {
            color: #ffbe0b !important;
        }

        .search-box {
            margin-bottom: 20px;
            text-align: center;
            position: sticky;
            top: 20px;
            z-index: 100;
            background: rgba(26, 26, 46, 0.95);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .controls-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4ecdc4;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4ecdc4;
        }

        .checkbox-group label {
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        .dropdown-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dropdown-label {
            font-size: 14px;
            color: #4ecdc4;
            white-space: nowrap;
        }

        .multi-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            color: #e8e6e3;
            padding: 6px 12px;
            font-size: 13px;
            min-width: 100px;
            cursor: pointer;
        }

        .multi-select option {
            background: #1a1a2e;
            color: #e8e6e3;
        }

        .clear-btn {
            padding: 8px 16px;
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            border-radius: 8px;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        .search-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .search-input {
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #4ecdc4;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: #e8e6e3;
            width: 300px;
            max-width: 90%;
        }

        .search-input::placeholder {
            color: rgba(232, 230, 227, 0.6);
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid #4ecdc4;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            width: 300px;
            max-width: 90%;
            margin-top: 5px;
            backdrop-filter: blur(10px);
        }

        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(78, 205, 196, 0.2);
            color: #e8e6e3;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .autocomplete-item:hover {
            background: rgba(78, 205, 196, 0.2);
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-type {
            font-size: 0.8rem;
            opacity: 0.7;
            font-style: italic;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 10px 20px;
            background: rgba(78, 205, 196, 0.2);
            border: 2px solid #4ecdc4;
            border-radius: 25px;
            color: #4ecdc4;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .control-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            transform: translateY(-2px);
        }

        .control-btn.active {
            background: #4ecdc4;
            color: #1a1a2e;
        }

        .verse {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .verse:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }

        .verse-number {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .sanskrit {
            font-size: 1.4rem;
            color: #ffbe0b;
            margin-bottom: 15px;
            line-height: 1.8;
            font-weight: 500;
            display: none;
        }

        .show-sanskrit .sanskrit {
            display: block;
        }

        .transliteration {
            font-size: 1.1rem;
            color: #fb8500;
            margin-bottom: 15px;
            font-style: italic;
            display: none;
        }

        .translation {
            font-size: 1.1rem;
            color: #e8e6e3;
            line-height: 1.7;
        }

        .deities {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .deity {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ff6b6b;
            font-weight: 500;
        }

        .direction {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #4ecdc4;
            font-weight: 500;
        }

        .body-part {
            background: rgba(251, 133, 0, 0.2);
            border: 1px solid #fb8500;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #fb8500;
            font-weight: 500;
        }

        .deity-name {
            color: #ff6b6b;
            font-weight: 600;
        }

        .direction-name {
            color: #4ecdc4;
            font-weight: 600;
        }

        .body-name {
            color: #fb8500;
            font-weight: 600;
        }

        .hidden {
            display: none;
        }

        .show-transliteration .transliteration {
            display: block;
        }

        .verse.highlighted {
            background: rgba(255, 107, 107, 0.15);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .verse.highlight-directions {
            background: rgba(78, 205, 196, 0.1);
            border-color: rgba(78, 205, 196, 0.4);
        }

        .verse.highlight-deities {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.4);
        }

        .verse.highlight-body {
            background: rgba(251, 133, 0, 0.1);
            border-color: rgba(251, 133, 0, 0.4);
        }

        .notes {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #4ecdc4;
            padding: 20px;
            margin-top: 30px;
            border-radius: 0 10px 10px 0;
        }

        .notes h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            .sanskrit {
                font-size: 1.2rem;
            }
            .controls {
                justify-content: center;
            }
            .control-btn {
                font-size: 12px;
                padding: 8px 16px;
            }
            .filters-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Force horizontal layout for filters */
        .filters-row {
            display: flex !important;
            flex-direction: row !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 10px !important;
            margin-bottom: 10px !important;
            flex-wrap: nowrap !important;
            width: 100% !important;
        }

        /* Force horizontal layout for filter tags */
        .active-filters {
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: wrap !important;
            gap: 6px !important;
            justify-content: center !important;
            margin-bottom: 15px !important;
            width: 100% !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">‡§∂‡•ç‡§∞‡•Ä‡§¶‡§∂‡§Æ‡§π‡§æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§ï‡§µ‡§ö‡§Æ‡•ç</h1>
            <p class="subtitle">The Armor of the Ten Great Wisdom Goddesses</p>
            <p class="demo-link" style="font-size: 0.9rem; margin-top: 8px;">Created with üôèüèæ‚ù§ü™∑: <a href="https://github.com/yogaedu-org" target="_blank" class="demo-link">yogaedu.org</a></p>
        </div>

        <div class="search-box" id="searchBox">
            <div class="controls-row">
                <div class="checkbox-group">
                    <input type="checkbox" id="sanskritCheck" checked>
                    <label for="sanskritCheck">Show Sanskrit</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="transliterationCheck" checked>
                    <label for="transliterationCheck">Show Transliteration</label>
                </div>
                
                <button class="clear-btn" id="clearFiltersBtn">Clear Filters</button>
            </div>
            
            <div class="filters-row">
                <div class="dropdown-group">
                    <span class="dropdown-label">Deities:</span>
                    <div class="custom-dropdown">
                        <div class="dropdown-button" id="deitiesDropdownBtn">
                            <span id="deitiesSelectedText">Select...</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-content hidden" id="deitiesDropdownContent"></div>
                    </div>
                </div>
                
                <div class="dropdown-group">
                    <span class="dropdown-label">Directions:</span>
                    <div class="custom-dropdown">
                        <div class="dropdown-button" id="directionsDropdownBtn">
                            <span id="directionsSelectedText">Select...</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-content hidden" id="directionsDropdownContent"></div>
                    </div>
                </div>
                
                <div class="dropdown-group">
                    <span class="dropdown-label">Body:</span>
                    <div class="custom-dropdown">
                        <div class="dropdown-button" id="bodyDropdownBtn">
                            <span id="bodySelectedText">Select...</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-content hidden" id="bodyDropdownContent"></div>
                    </div>
                </div>
            </div>
            
            <div class="active-filters" id="activeFilters">
                <!-- Active filter tags will appear here -->
            </div>
            
            <div class="search-input-wrapper">
                <input type="text" class="search-input" placeholder="Search deities, directions, or body parts..." id="searchInput" autocomplete="off">
                <div class="autocomplete-dropdown hidden" id="autocompleteDropdown"></div>
            </div>
        </div>

        <div class="controls">
            <!-- Controls moved to search box -->
        </div>

        <div id="verses">
            <!-- Verses will be populated by JavaScript -->
        </div>

        <div class="notes">
            <h3>Notes</h3>
            <p><strong>Directional Protection:</strong> The kavacam systematically covers all eight directions plus above and all-around protection, creating a complete spiritual armor.</p>
            <p><strong>Anatomical Coverage:</strong> From head to toe, every part of the body is placed under divine protection through specific goddess invocations.</p>
            <p><strong>Epithets:</strong> Some names may vary across recensions and represent regional or textual variations.</p>
        </div>
    </div>

    <script>
        /*
        ================================================================================
        ≈öRƒ™DA≈öAMAHƒÄVIDYƒÄKAVACAM - INTERACTIVE STUDY TOOL
        ================================================================================
        
        OVERVIEW:
        Interactive web application for studying the Da≈õamahƒÅvidyƒÅ Kavacam (Armor of 
        the Ten Great Wisdom Goddesses). Provides multi-modal exploration through 
        Sanskrit text, transliteration, translation, and intelligent filtering.
        
        CORE FEATURES:
        ‚Ä¢ Dual text display controls (Sanskrit/Transliteration toggle independently)
        ‚Ä¢ Real-time search with autocomplete for deities, directions, body parts
        ‚Ä¢ Multi-category filtering with visual tags and OR-logic
        ‚Ä¢ Responsive sticky navigation with glassmorphism design
        ‚Ä¢ Complete 14-verse coverage with metadata-driven categorization
        
        TECHNICAL ARCHITECTURE:
        ‚Ä¢ Data Layer: VERSE_DATA array with structured verse objects
        ‚Ä¢ State Management: AppState object with centralized application state
        ‚Ä¢ UI Layer: UI object handling all DOM interactions and rendering
        ‚Ä¢ No external dependencies (pure HTML/CSS/JS)
        
        DATA STRUCTURE:
        Each verse object contains:
        - number: Verse number (1-14)
        - sanskrit: DevanƒÅgarƒ´ text with HTML line breaks
        - transliteration: IAST romanization
        - translation: English prose translation
        - deities: Array of goddess names/epithets
        - directions: Array of spatial orientations
        - bodyParts: Array of anatomical terms
        
        FILTERING LOGIC:
        ‚Ä¢ Uses OR-based logic across all categories
        ‚Ä¢ Search integrates with filter system via tag creation
        ‚Ä¢ Visual feedback through colored highlighting and tags
        ‚Ä¢ State persistence during interaction sessions
        
        CSS FRAMEWORK:
        ‚Ä¢ Custom responsive design with mobile-first approach
        ‚Ä¢ Glassmorphism effects with backdrop-filter
        ‚Ä¢ Color-coded categories (red=deities, teal=directions, orange=body)
        ‚Ä¢ Smooth transitions and hover states
        ‚Ä¢ Sticky positioning for persistent navigation
        
        KEY COMPONENTS:
        1. AppState.buildSearchableItems() - Creates searchable term index
        2. UI.populateCustomDropdown() - Builds interactive filter dropdowns
        3. UI.updateFilterTags() - Manages visual filter tag system
        4. UI.handleSearch() - Processes search input and autocomplete
        5. UI.updateHighlights() - Applies OR-logic filtering and highlighting
        
        REPRODUCTION REQUIREMENTS:
        ‚Ä¢ Single HTML file with embedded CSS/JS
        ‚Ä¢ Traditional JavaScript (no ES6) for compatibility
        ‚Ä¢ Structured verse data with categorical metadata arrays
        ‚Ä¢ Event handling for dropdowns, checkboxes, search, and tags
        ‚Ä¢ CSS classes for text display control and visual feedback
        
        LIVE DEMO: https://yogaedu-org.github.io/dmv-kavacham-study-tool/dmv-kavacham-interactive.html
        DIRECT ARTIFACT LINK: https://claude.ai/public/artifacts/dc3235ea-ea7f-49f2-897a-df6c650264f1
        
        USAGE PATTERNS:
        ‚Ä¢ Text Study: Toggle Sanskrit/transliteration for learning
        ‚Ä¢ Deity Research: Filter by goddess names across verses
        ‚Ä¢ Spatial Analysis: Explore directional protection patterns
        ‚Ä¢ Anatomical Mapping: Study body part coverage
        ‚Ä¢ Cross-Reference: Use search to find specific terms
        
        EXTENSIBILITY:
        ‚Ä¢ Add verses by extending VERSE_DATA array
        ‚Ä¢ Create new categories by adding metadata arrays
        ‚Ä¢ Implement additional filtering logic in updateHighlights()
        ‚Ä¢ Customize UI styling through CSS variable system
        ‚Ä¢ Integrate with external APIs through state management layer
        
        PERFORMANCE CONSIDERATIONS:
        ‚Ä¢ Efficient DOM manipulation through cached element references
        ‚Ä¢ Debounced search to prevent excessive filtering
        ‚Ä¢ Minimal re-rendering with targeted updates
        ‚Ä¢ Event delegation for dynamic content
        
        ACCESSIBILITY FEATURES:
        ‚Ä¢ Semantic HTML structure with proper headings
        ‚Ä¢ Keyboard navigation support for interactive elements
        ‚Ä¢ High contrast color schemes for readability
        ‚Ä¢ Responsive design for various screen sizes
        ‚Ä¢ Clear visual feedback for state changes
        
        ================================================================================
        */
        
        
        // =============================================================================
        // DATA LAYER - Easy to expand
        // =============================================================================
        
        var VERSE_DATA = [
            {
                number: 1,
                sanskrit: "‡•ê ‡§™‡•ç‡§∞‡§æ‡§ö‡•ç‡§Ø‡§æ‡§Ç ‡§∞‡§ï‡•ç‡§∑‡§§‡•Å ‡§Æ‡•á ‡§§‡§æ‡§∞‡§æ ‡§ï‡§æ‡§Æ‡§∞‡•Ç‡§™‡§®‡§ø‡§µ‡§æ‡§∏‡§ø‡§®‡•Ä ‡•§<br>‡§Ü‡§ó‡•ç‡§®‡•á‡§Ø‡•ç‡§Ø‡§æ‡§Ç ‡§∑‡•ã‡§°‡§∂‡•Ä ‡§™‡§æ‡§§‡•Å ‡§Ø‡§æ‡§Æ‡•ç‡§Ø‡§æ‡§Ç ‡§ß‡•Ç‡§Æ‡§æ‡§µ‡§§‡•Ä ‡§∏‡•ç‡§µ‡§Ø‡§Æ‡•ç ‡••‡•ß‡••",
                transliteration: "Om prƒÅcyƒÅ·πÉ rak·π£atu me tƒÅrƒÅ kƒÅmar≈´panivƒÅsinƒ´ |<br>ƒÅgneyƒÅ·πÉ ·π£o·∏ça≈õƒ´ pƒÅtu yƒÅmyƒÅ·πÉ dh≈´mƒÅvatƒ´ svayam ||1||",
                translation: "May TƒÅrƒÅ, who dwells in KƒÅmar≈´pa, guard me in the east. In the southeast may ·π¢o·∏ça≈õƒ´ (Tripurasundarƒ´) protect me; in the south, DhumƒÅvatƒ´ herself.",
                deities: ["Tara", "Sodasi", "Tripurasundari", "Dhumavati"],
                directions: ["East", "Southeast", "South"],
                bodyParts: []
            },
            {
                number: 2,
                sanskrit: "‡§®‡•à‡§∞‡•É‡§§‡•ç‡§Ø‡§æ‡§Ç ‡§≠‡•à‡§∞‡§µ‡•Ä ‡§™‡§æ‡§§‡•Å ‡§µ‡§æ‡§∞‡•Å‡§£‡•ç‡§Ø‡§æ‡§Ç ‡§≠‡•Å‡§µ‡§®‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä ‡•§<br>‡§µ‡§æ‡§Ø‡§µ‡•ç‡§Ø‡§æ‡§Ç ‡§∏‡§§‡§§‡§Ç ‡§™‡§æ‡§§‡•Å ‡§õ‡§ø‡§®‡•ç‡§®‡§Æ‡§∏‡•ç‡§§‡§æ ‡§Æ‡§π‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä ‡••‡•®‡••",
                transliteration: "nair·πõtyƒÅ·πÉ bhairavƒ´ pƒÅtu vƒÅru·πáyƒÅ·πÉ bhuvane≈õvarƒ´ |<br>vƒÅyavyƒÅ·πÉ satata·πÉ pƒÅtu chinnamastƒÅ mahe≈õvarƒ´ ||2||",
                translation: "In the southwest may Bhairavƒ´ protect; in the west, Bhuvane≈õvarƒ´. In the northwest may the great goddess ChinnamastƒÅ protect me always.",
                deities: ["Bhairavi", "Bhuvaneshvari", "Chinnamasta", "Maheshvari"],
                directions: ["Southwest", "West", "Northwest"],
                bodyParts: []
            },
            {
                number: 3,
                sanskrit: "‡§ï‡•å‡§¨‡•á‡§∞‡•ç‡§Ø‡§æ‡§Ç ‡§™‡§æ‡§§‡•Å ‡§Æ‡•á ‡§¶‡•á‡§µ‡•Ä ‡§∂‡•ç‡§∞‡•Ä‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§¨‡§ó‡§≤‡§æ‡§Æ‡•Å‡§ñ‡•Ä ‡•§<br>‡§ê‡§∂‡§æ‡§®‡•ç‡§Ø‡§æ‡§Ç ‡§™‡§æ‡§§‡•Å ‡§Æ‡•á ‡§®‡§ø‡§§‡•ç‡§Ø‡§Ç ‡§Æ‡§π‡§æ‡§§‡•ç‡§∞‡§ø‡§™‡•Å‡§∞‡§∏‡•Å‡§®‡•ç‡§¶‡§∞‡•Ä ‡••‡•©‡••",
                transliteration: "kauberyƒÅ·πÉ pƒÅtu me devƒ´ ≈õrƒ´vidyƒÅ bagalƒÅmukhƒ´ |<br>ai≈õƒÅnyƒÅ·πÉ pƒÅtu me nitya·πÉ mahƒÅtripurasundarƒ´ ||3||",
                translation: "In Kubera's quarter (the north) may the goddess ≈örƒ´vidyƒÅ‚ÄîBagalƒÅmukhƒ´‚Äîprotect me. In ƒ™≈õƒÅna's quarter (the northeast) may MahƒÅ‚ÄëTripurasundarƒ´ protect me always.",
                deities: ["Srividya", "Bagalamukhi", "Mahatripurasundari"],
                directions: ["North", "Northeast"],
                bodyParts: []
            },
            {
                number: 4,
                sanskrit: "‡§ä‡§∞‡•ç‡§ß‡•ç‡§µ‡§Ç ‡§∞‡§ï‡•ç‡§∑‡§§‡•Å ‡§Æ‡•á ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§Æ‡§æ‡§§‡§ô‡•ç‡§ó‡•Ä‡§™‡•Ä‡§†‡§µ‡§æ‡§∏‡§ø‡§®‡•Ä ‡•§<br>‡§∏‡§∞‡•ç‡§µ‡§§‡§É ‡§™‡§æ‡§§‡•Å ‡§Æ‡•á ‡§®‡§ø‡§§‡•ç‡§Ø‡§Ç ‡§ï‡§æ‡§Æ‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡§æ‡§≤‡§ø‡§ï‡§æ ‡§∏‡•ç‡§µ‡§Ø‡§Æ‡•ç ‡••‡•™‡••",
                transliteration: "≈´rdhva·πÉ rak·π£atu me vidyƒÅ mƒÅta·πÖgƒ´pƒ´·π≠havƒÅsinƒ´ |<br>sarvata·∏• pƒÅtu me nitya·πÉ kƒÅmƒÅkhyƒÅ kƒÅlikƒÅ svayam ||4||",
                translation: "Above, may VidyƒÅ MƒÅtangƒ´, who abides at her sacred seat, guard me. On all sides may KƒÅlikƒÅ of KƒÅmƒÅkhyƒÅ protect me always.",
                deities: ["Vidya", "Matangi", "Kamakhya", "Kalika"],
                directions: ["Above", "All sides"],
                bodyParts: []
            },
            {
                number: 5,
                sanskrit: "‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§∞‡•Ç‡§™‡§æ ‡§Æ‡§π‡§æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§∏‡§∞‡•ç‡§µ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§Æ‡§Ø‡•Ä ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡•§<br>‡§∂‡•Ä‡§∞‡•ç‡§∑‡•á ‡§∞‡§ï‡•ç‡§∑‡§§‡•Å ‡§Æ‡•á ‡§¶‡•Å‡§∞‡•ç‡§ó‡§æ ‡§≠‡§æ‡§≤‡§Ç ‡§∂‡•ç‡§∞‡•Ä‡§≠‡§µ‡§ó‡•á‡§π‡§ø‡§®‡•Ä ‡••‡•´‡••",
                transliteration: "brahmar≈´pƒÅ mahƒÅvidyƒÅ sarvavidyƒÅmayƒ´ svayam |<br>≈õƒ´r·π£e rak·π£atu me durgƒÅ bhƒÅla·πÉ ≈õrƒ´bhavagehinƒ´ ||5||",
                translation: "She is the Great VidyƒÅ, of the very form of Brahman, the essence of all knowledges. May DurgƒÅ guard my head; may ≈örƒ´‚ÄëBhavagehinƒ´ guard my forehead.",
                deities: ["Mahavidya", "Durga", "Shribhavagahini", "Parvati"],
                directions: [],
                bodyParts: ["Head", "Forehead"]
            },
            {
                number: 6,
                sanskrit: "‡§§‡•ç‡§∞‡§ø‡§™‡•Å‡§∞‡§æ ‡§≠‡•ç‡§∞‡•Å‡§Ø‡•Å‡§ó‡•á ‡§™‡§æ‡§§‡•Å ‡§∂‡§∞‡•ç‡§µ‡§æ‡§£‡•Ä ‡§™‡§æ‡§§‡•Å ‡§®‡§æ‡§∏‡§ø‡§ï‡§æ‡§Æ‡•ç ‡•§<br>‡§ö‡§ï‡•ç‡§∑‡•Å‡§∑‡•Ä ‡§ö‡§£‡•ç‡§°‡§ø‡§ï‡§æ ‡§™‡§æ‡§§‡•Å ‡§∂‡•ç‡§∞‡•ã‡§§‡•ç‡§∞‡•á ‡§®‡•Ä‡§≤‡§∏‡§∞‡§∏‡•ç‡§µ‡§§‡•Ä ‡••‡•¨‡••",
                transliteration: "tripurƒÅ bhruyuge pƒÅtu ≈õarva·πáƒ´ pƒÅtu nƒÅsikƒÅm |<br>cak·π£u·π£ƒ´ ca·πá·∏çikƒÅ pƒÅtu ≈õrotre nƒ´lasarasvatƒ´ ||6||",
                translation: "May TripurƒÅ guard my brows; may ≈öarva·πáƒ´ (PƒÅrvatƒ´) guard my nose. May Ca·πá·∏çikƒÅ guard my eyes; may Nƒ´la‚ÄëSarasvatƒ´ guard my ears.",
                deities: ["Tripura", "Sarvani", "Parvati", "Candika", "Nilasarasvati"],
                directions: [],
                bodyParts: ["Brows", "Nose", "Eyes", "Ears"]
            },
            {
                number: 7,
                sanskrit: "‡§Æ‡•Å‡§ñ‡§Ç ‡§∏‡•å‡§Æ‡•ç‡§Ø‡§Æ‡•Å‡§ñ‡•Ä ‡§™‡§æ‡§§‡•Å ‡§ó‡•ç‡§∞‡•Ä‡§µ‡§æ‡§Ç ‡§∞‡§ï‡•ç‡§∑‡§§‡•Å ‡§™‡§æ‡§∞‡•ç‡§µ‡§§‡•Ä ‡•§<br>‡§ú‡§ø‡§π‡•ç‡§µ‡§æ‡§Ç ‡§∞‡§ï‡•ç‡§∑‡§§‡•Å ‡§Æ‡•á ‡§¶‡•á‡§µ‡•Ä ‡§ú‡§ø‡§π‡•ç‡§µ‡§æ‡§≤‡§≤‡§®‡§≠‡•Ä‡§∑‡§£‡§æ ‡••‡•≠‡••",
                transliteration: "mukha·πÉ saumyamukhƒ´ pƒÅtu grƒ´vƒÅ·πÉ rak·π£atu pƒÅrvatƒ´ |<br>jihvƒÅ·πÉ rak·π£atu me devƒ´ jihvƒÅlalanabhƒ´·π£a·πáƒÅ ||7||",
                translation: "May the gentle‚Äëfaced One protect my face; may PƒÅrvatƒ´ guard my neck. May the goddess‚Äîfearsome to foes‚Äîguard my tongue.",
                deities: ["Saumyamukhi", "Parvati", "Jihvalalanabhisana"],
                directions: [],
                bodyParts: ["Face", "Neck", "Tongue"]
            },
            {
                number: 8,
                sanskrit: "‡§µ‡§æ‡§ó‡•ç‡§¶‡•á‡§µ‡•Ä ‡§µ‡§¶‡§®‡§Ç ‡§™‡§æ‡§§‡•Å ‡§µ‡§ï‡•ç‡§∑‡§É ‡§™‡§æ‡§§‡•Å ‡§Æ‡§π‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä ‡•§<br>‡§¨‡§æ‡§π‡•Ç ‡§Æ‡§π‡§æ‡§≠‡•Å‡§ú‡§æ ‡§™‡§æ‡§§‡•Å ‡§ï‡§∞‡§æ‡§ô‡•ç‡§ó‡•Å‡§≤‡•Ä‡§É ‡§∏‡•Å‡§∞‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä ‡••‡•Æ‡••",
                transliteration: "vƒÅgdevƒ´ vadana·πÉ pƒÅtu vak·π£a·∏• pƒÅtu mahe≈õvarƒ´ |<br>bƒÅh≈´ mahƒÅbhujƒÅ pƒÅtu karƒÅ·πÖgulƒ´·∏• sure≈õvarƒ´ ||8||",
                translation: "May VƒÅgdevƒ´ protect my speech and mouth; may Mahe≈õvarƒ´ guard my chest. May the Mighty‚ÄëArmed One protect my arms, and the Queen of the gods protect my fingers.",
                deities: ["Vagdevi", "Maheshvari", "Mahabhuja", "Sureshvari"],
                directions: [],
                bodyParts: ["Speech", "Mouth", "Chest", "Arms", "Fingers"]
            },
            {
                number: 9,
                sanskrit: "‡§™‡•É‡§∑‡•ç‡§†‡§§‡§É ‡§™‡§æ‡§§‡•Å ‡§≠‡•Ä‡§Æ‡§æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§ü‡•ç‡§Ø‡§æ‡§Ç ‡§¶‡•á‡§µ‡•Ä ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞‡•Ä ‡•§<br>‡§â‡§¶‡§∞‡§Ç ‡§™‡§æ‡§§‡•Å ‡§Æ‡•á ‡§®‡§ø‡§§‡•ç‡§Ø‡§Ç ‡§Æ‡§π‡§æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§Æ‡§π‡•ã‡§¶‡§∞‡•Ä ‡••‡•Ø‡••",
                transliteration: "p·πõ·π£·π≠hata·∏• pƒÅtu bhƒ´mƒÅsyƒÅ ka·π≠yƒÅ·πÉ devƒ´ digambarƒ´ |<br>udara·πÉ pƒÅtu me nitya·πÉ mahƒÅvidyƒÅ mahodarƒ´ ||9||",
                translation: "From behind may Bhƒ´mƒÅsyƒÅ protect; at the hips, the goddess Digambarƒ´. May the Great VidyƒÅ Mahodari always protect my abdomen.",
                deities: ["Bhimasya", "Digambari", "Mahavidya", "Mahodari"],
                directions: ["Behind"],
                bodyParts: ["Hips", "Abdomen"]
            },
            {
                number: 10,
                sanskrit: "‡§â‡§ó‡•ç‡§∞‡§§‡§æ‡§∞‡§æ ‡§Æ‡§π‡§æ‡§¶‡•á‡§µ‡•Ä ‡§ú‡§ô‡•ç‡§ò‡•ã‡§∞‡•Ç ‡§™‡§∞‡§ø‡§∞‡§ï‡•ç‡§∑‡§§‡•Å ‡•§<br>‡§â‡§ó‡•ç‡§∞‡§§‡§æ‡§∞‡§æ ‡§ó‡•Å‡§¶‡§Ç ‡§Æ‡•Å‡§∑‡•ç‡§ï‡§Ç ‡§ö ‡§Æ‡•á‡§¢‡•ç‡§∞‡§Ç ‡§ö ‡§®‡§æ‡§≠‡§ø‡§Ç ‡§ö ‡§∏‡•Å‡§∞‡§∏‡•Å‡§®‡•ç‡§¶‡§∞‡•Ä ‡••‡•ß‡•¶‡••",
                transliteration: "ugratƒÅrƒÅ mahƒÅdevƒ´ ja·πÖghor≈´ parirak·π£atu |<br>ugratƒÅrƒÅ guda·πÉ mu·π£ka·πÉ ca me·∏çhra·πÉ ca nƒÅbhi·πÉ ca surasundarƒ´ ||10||",
                translation: "May the great goddess UgratƒÅrƒÅ protect my shanks and thighs. May UgratƒÅrƒÅ‚ÄîSurasundarƒ´‚Äîguard the anus, the scrotum, the phallus, and the navel.",
                deities: ["Ugratara", "Mahadevi", "Surasundari"],
                directions: [],
                bodyParts: ["Shanks", "Thighs", "Knees", "Legs", "Anus", "Scrotum", "Phallus", "Navel"]
            },
            {
                number: 11,
                sanskrit: "‡§™‡§æ‡§¶‡§æ‡§ô‡•ç‡§ó‡•Å‡§≤‡•Ä‡§É ‡§∏‡§¶‡§æ ‡§™‡§æ‡§§‡•Å ‡§≠‡§µ‡§æ‡§®‡•Ä ‡§§‡•ç‡§∞‡§ø‡§¶‡§∂‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä ‡•§<br>‡§∞‡§ï‡•ç‡§§‡§Æ‡§æ‡§Ç‡§∏‡§æ‡§∏‡•ç‡§•‡§ø‡§Æ‡§ú‡•ç‡§ú‡§æ‡§¶‡•Ä‡§®‡•ç ‡§™‡§æ‡§§‡•Å ‡§¶‡•á‡§µ‡•Ä ‡§∂‡§µ‡§æ‡§∏‡§®‡§æ ‡••‡•ß‡•ß‡••",
                transliteration: "pƒÅdƒÅ·πÖgulƒ´·∏• sadƒÅ pƒÅtu bhavƒÅnƒ´ trida≈õe≈õvarƒ´ |<br>raktamƒÅ·πÉsƒÅsthimajjƒÅdƒ´n pƒÅtu devƒ´ ≈õavƒÅsanƒÅ ||11||",
                translation: "May BhavƒÅnƒ´, queen of the gods, always protect my toes. May the goddess who is seated upon a corpse protect my blood, flesh, bones, marrow, and the rest.",
                deities: ["Bhavani", "Tridaseshvari", "Shavasana"],
                directions: [],
                bodyParts: ["Toes", "Blood", "Flesh", "Bones", "Marrow"]
            },
            {
                number: 12,
                sanskrit: "‡§Æ‡§π‡§æ‡§≠‡§Ø‡•á‡§∑‡•Å ‡§ò‡•ã‡§∞‡•á‡§∑‡•Å ‡§Æ‡§π‡§æ‡§≠‡§Ø‡§®‡§ø‡§µ‡§æ‡§∞‡§ø‡§£‡•Ä ‡•§<br>‡§™‡§æ‡§§‡•Å ‡§¶‡•á‡§µ‡•Ä ‡§Æ‡§π‡§æ‡§Æ‡§æ‡§Ø‡§æ ‡§ï‡§æ‡§Æ‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§™‡•Ä‡§†‡§µ‡§æ‡§∏‡§ø‡§®‡•Ä ‡••‡•ß‡•®‡••",
                transliteration: "mahƒÅbhaye·π£u ghore·π£u mahƒÅbhayanivƒÅri·πáƒ´ |<br>pƒÅtu devƒ´ mahƒÅmƒÅyƒÅ kƒÅmƒÅkhyƒÅpƒ´·π≠havƒÅsinƒ´ ||12||",
                translation: "In great and terrible dangers, may the remover of great fear‚ÄîMahƒÅmƒÅyƒÅ, who dwells at the seat of KƒÅmƒÅkhyƒÅ‚Äîprotect me.",
                deities: ["Mahabhayanivairini", "Mahamaya", "Kamakhyapithvasini"],
                directions: [],
                bodyParts: []
            },
            {
                number: 13,
                sanskrit: "‡§≠‡§∏‡•ç‡§Æ‡§æ‡§ö‡§≤‡§ó‡§§‡§æ ‡§¶‡§ø‡§µ‡•ç‡§Ø‡§∏‡§ø‡§Ç‡§π‡§æ‡§∏‡§®‡§ï‡•É‡§§‡§æ‡§∂‡•ç‡§∞‡§Ø‡§æ ‡•§<br>‡§™‡§æ‡§§‡•Å ‡§∂‡•ç‡§∞‡•Ä‡§ï‡§æ‡§≤‡§ø‡§ï‡§æ‡§¶‡•á‡§µ‡•Ä ‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§™‡§æ‡§§‡•á‡§∑‡•Å ‡§∏‡§∞‡•ç‡§µ‡§¶‡§æ ‡••‡•ß‡•©‡••",
                transliteration: "bhasmƒÅcalagatƒÅ divyasi·πÉhƒÅsanak·πõtƒÅ≈õrayƒÅ |<br>pƒÅtu ≈õrƒ´kƒÅlikƒÅdevƒ´ sarvotpƒÅte·π£u sarvadƒÅ ||13||",
                translation: "Residing on the mountain of ash, enthroned upon the divine lion seat‚Äîmay ≈örƒ´ KƒÅlika‚Äëdevƒ´ protect me from every calamity, always.",
                deities: ["Shrikalikadevii"],
                directions: [],
                bodyParts: []
            },
            {
                number: 14,
                sanskrit: "‡§∞‡§ï‡•ç‡§∑‡§æ‡§π‡•Ä‡§®‡§Ç ‡§§‡•Å ‡§Ø‡§§‡•ç‡§∏‡•ç‡§•‡§æ‡§®‡§Ç ‡§ï‡§µ‡§ö‡•á‡§®‡§æ‡§™‡§ø ‡§µ‡§∞‡•ç‡§ú‡§ø‡§§‡§Æ‡•ç ‡•§<br>‡§§‡§§‡•ç‡§∏‡§∞‡•ç‡§µ‡§Ç ‡§∏‡§∞‡•ç‡§µ‡§¶‡§æ ‡§™‡§æ‡§§‡•Å ‡§∏‡§∞‡•ç‡§µ‡§∞‡§ï‡•ç‡§∑‡§£‡§ï‡§æ‡§∞‡§ø‡§£‡•Ä ‡••‡•ß‡•™‡••",
                transliteration: "rak·π£ƒÅhƒ´na·πÉ tu yatsthƒÅna·πÉ kavacenƒÅpi varjitam |<br>tatsarva·πÉ sarvadƒÅ pƒÅtu sarvarak·π£a·πáakƒÅri·πáƒ´ ||14||",
                translation: "And whatever place is left unprotected‚Äîomitted even by this armor‚Äîmay the All‚ÄëProtecting Goddess guard all of that, at all times.",
                deities: ["Sarvaraksanakarini"],
                directions: [],
                bodyParts: []
            }
        ];
        
        // =============================================================================
        // STATE MANAGEMENT
        // =============================================================================
        
        var AppState = {
            verses: VERSE_DATA,
            searchableItems: [],
            currentHighlight: '',
            showTransliteration: true, // Default to true
            showSanskrit: true, // Default to true
            selectedDirections: [],
            selectedDeities: [],
            selectedBodyParts: [],
            
            init: function() {
                this.searchableItems = this.buildSearchableItems();
            },
            
            buildSearchableItems: function() {
                var items = [];
                var self = this;
                
                this.verses.forEach(function(verse) {
                    // Add deities
                    verse.deities.forEach(function(deity) {
                        if (!self.findItem(items, deity)) {
                            items.push({ text: deity, type: 'deity' });
                        }
                    });
                    
                    // Add directions  
                    verse.directions.forEach(function(direction) {
                        if (!self.findItem(items, direction)) {
                            items.push({ text: direction, type: 'direction' });
                        }
                    });
                    
                    // Add body parts
                    verse.bodyParts.forEach(function(bodyPart) {
                        if (!self.findItem(items, bodyPart)) {
                            items.push({ text: bodyPart, type: 'body' });
                        }
                    });
                });
                
                return items.sort(function(a, b) { return a.text.localeCompare(b.text); });
            },
            
            findItem: function(items, text) {
                for (var i = 0; i < items.length; i++) {
                    if (items[i].text.toLowerCase() === text.toLowerCase()) {
                        return true;
                    }
                }
                return false;
            },
            
            toggleTransliteration: function() {
                this.showTransliteration = !this.showTransliteration;
                UI.updateTransliterationView();
            },
            
            setFilters: function(directions, deities, bodyParts) {
                this.selectedDirections = directions || [];
                this.selectedDeities = deities || [];
                this.selectedBodyParts = bodyParts || [];
                UI.updateHighlights();
            },
            
            clearFilters: function() {
                this.selectedDirections = [];
                this.selectedDeities = [];
                this.selectedBodyParts = [];
                UI.clearAllFilters();
            },
            
            setHighlight: function(category) {
                if (this.currentHighlight === category) {
                    this.currentHighlight = '';
                } else {
                    this.currentHighlight = category;
                }
                UI.updateHighlights();
            }
        };
        
        // =============================================================================
        // UI LAYER
        // =============================================================================
        
        var UI = {
            elements: {
                versesContainer: null,
                searchInput: null,
                autocompleteDropdown: null,
                transliterationCheck: null,
                sanskritCheck: null,
                deitiesDropdownBtn: null,
                directionsDropdownBtn: null,
                bodyDropdownBtn: null,
                deitiesDropdownContent: null,
                directionsDropdownContent: null,
                bodyDropdownContent: null,
                clearFiltersBtn: null,
                activeFilters: null,
                searchBox: null
            },
            
            init: function() {
                this.cacheElements();
                this.bindEvents();
                this.render();
            },
            
            cacheElements: function() {
                this.elements.versesContainer = document.getElementById('verses');
                this.elements.searchInput = document.getElementById('searchInput');
                this.elements.autocompleteDropdown = document.getElementById('autocompleteDropdown');
                this.elements.transliterationCheck = document.getElementById('transliterationCheck');
                this.elements.sanskritCheck = document.getElementById('sanskritCheck');
                this.elements.deitiesDropdownBtn = document.getElementById('deitiesDropdownBtn');
                this.elements.directionsDropdownBtn = document.getElementById('directionsDropdownBtn');
                this.elements.bodyDropdownBtn = document.getElementById('bodyDropdownBtn');
                this.elements.deitiesDropdownContent = document.getElementById('deitiesDropdownContent');
                this.elements.directionsDropdownContent = document.getElementById('directionsDropdownContent');
                this.elements.bodyDropdownContent = document.getElementById('bodyDropdownContent');
                this.elements.clearFiltersBtn = document.getElementById('clearFiltersBtn');
                this.elements.activeFilters = document.getElementById('activeFilters');
                this.elements.searchBox = document.getElementById('searchBox');
            },
            
            bindEvents: function() {
                var self = this;
                
                this.elements.transliterationCheck.addEventListener('change', function() {
                    AppState.showTransliteration = this.checked;
                    self.updateTransliterationView();
                });
                
                this.elements.sanskritCheck.addEventListener('change', function() {
                    AppState.showSanskrit = this.checked;
                    self.updateSanskritView();
                });
                
                this.elements.searchInput.addEventListener('input', function() {
                    self.handleSearch();
                });
                
                this.elements.clearFiltersBtn.addEventListener('click', function() {
                    AppState.clearFilters();
                });
                
                // Custom dropdown handlers
                this.elements.deitiesDropdownBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    self.toggleDropdown('deities');
                });
                
                this.elements.directionsDropdownBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    self.toggleDropdown('directions');
                });
                
                this.elements.bodyDropdownBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    self.toggleDropdown('body');
                });
                
                // Hide dropdowns when clicking outside
                document.addEventListener('click', function(e) {
                    self.closeAllDropdowns();
                    
                    var searchBox = document.querySelector('.search-input-wrapper');
                    if (!searchBox.contains(e.target)) {
                        self.elements.autocompleteDropdown.classList.add('hidden');
                    }
                });
                
                // Scroll detection for minimizing search box
                var lastScrollTop = 0;
                var isMinimized = false;
                var hoverTimeout;
                
                window.addEventListener('scroll', function() {
                    var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    
                    if (scrollTop > 100 && !isMinimized) {
                        self.elements.searchBox.classList.add('minimized');
                        isMinimized = true;
                    } else if (scrollTop <= 100 && isMinimized) {
                        self.elements.searchBox.classList.remove('minimized');
                        isMinimized = false;
                    }
                });
                
                // Hover to expand when minimized
                this.elements.searchBox.addEventListener('mouseenter', function() {
                    if (isMinimized) {
                        clearTimeout(hoverTimeout);
                        self.elements.searchBox.classList.remove('minimized');
                    }
                });
                
                this.elements.searchBox.addEventListener('mouseleave', function() {
                    if (window.pageYOffset > 100) {
                        hoverTimeout = setTimeout(function() {
                            self.elements.searchBox.classList.add('minimized');
                        }, 1000);
                    }
                });
            },
            
            render: function() {
                this.populateDropdowns();
                this.renderVerses();
                
                // Initialize body classes based on AppState
                if (AppState.showTransliteration) {
                    document.body.classList.add('show-transliteration');
                } else {
                    document.body.classList.remove('show-transliteration');
                }
                
                if (AppState.showSanskrit) {
                    document.body.classList.add('show-sanskrit');
                } else {
                    document.body.classList.remove('show-sanskrit');
                }
                
                this.updateTransliterationView();
                this.updateSanskritView();
            },
            
            populateDropdowns: function() {
                var directions = [];
                var deities = [];
                var bodyParts = [];
                
                AppState.searchableItems.forEach(function(item) {
                    if (item.type === 'direction') directions.push(item.text);
                    else if (item.type === 'deity') deities.push(item.text);
                    else if (item.type === 'body') bodyParts.push(item.text);
                });
                
                this.populateCustomDropdown(this.elements.deitiesDropdownContent, deities, 'deities');
                this.populateCustomDropdown(this.elements.directionsDropdownContent, directions, 'directions');
                this.populateCustomDropdown(this.elements.bodyDropdownContent, bodyParts, 'body');
            },
            
            populateCustomDropdown: function(container, options, type) {
                var self = this;
                var html = '';
                
                options.forEach(function(option) {
                    html += '<div class="dropdown-item" data-value="' + option + '" data-type="' + type + '">' +
                        '<input type="checkbox" class="dropdown-checkbox" id="' + type + '_' + option.replace(/\s+/g, '_') + '">' +
                        '<span class="dropdown-item-text">' + option + '</span>' +
                        '</div>';
                });
                
                container.innerHTML = html;
                
                // Add event listeners to checkboxes
                container.querySelectorAll('.dropdown-checkbox').forEach(function(checkbox) {
                    checkbox.addEventListener('change', function(e) {
                        e.stopPropagation();
                        self.handleFilterChange();
                        // Don't close dropdown when checking items
                    });
                });
                
                // Prevent dropdown from closing when clicking inside
                container.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            },
            
            toggleDropdown: function(type) {
                var content = this.elements[type + 'DropdownContent'];
                var button = this.elements[type + 'DropdownBtn'];
                
                // Close other dropdowns
                ['deities', 'directions', 'body'].forEach(function(otherType) {
                    if (otherType !== type) {
                        this.elements[otherType + 'DropdownContent'].classList.add('hidden');
                        this.elements[otherType + 'DropdownBtn'].classList.remove('active');
                    }
                }.bind(this));
                
                // Toggle current dropdown
                content.classList.toggle('hidden');
                button.classList.toggle('active');
            },
            
            closeAllDropdowns: function() {
                this.elements.deitiesDropdownContent.classList.add('hidden');
                this.elements.directionsDropdownContent.classList.add('hidden');
                this.elements.bodyDropdownContent.classList.add('hidden');
                this.elements.deitiesDropdownBtn.classList.remove('active');
                this.elements.directionsDropdownBtn.classList.remove('active');
                this.elements.bodyDropdownBtn.classList.remove('active');
            },
            
            handleFilterChange: function() {
                var selectedDeities = this.getSelectedFromDropdown('deities');
                var selectedDirections = this.getSelectedFromDropdown('directions');
                var selectedBodyParts = this.getSelectedFromDropdown('body');
                
                AppState.setFilters(selectedDirections, selectedDeities, selectedBodyParts);
                this.updateDropdownLabels();
                this.updateFilterTags();
            },
            
            getSelectedFromDropdown: function(type) {
                var container = this.elements[type + 'DropdownContent'];
                var selected = [];
                
                container.querySelectorAll('.dropdown-checkbox:checked').forEach(function(checkbox) {
                    var item = checkbox.closest('.dropdown-item');
                    selected.push(item.dataset.value);
                });
                
                return selected;
            },
            
            updateDropdownLabels: function() {
                this.updateDropdownLabel('deities', AppState.selectedDeities);
                this.updateDropdownLabel('directions', AppState.selectedDirections);
                this.updateDropdownLabel('body', AppState.selectedBodyParts);
            },
            
            updateDropdownLabel: function(type, selected) {
                var textElement = document.getElementById(type + 'SelectedText');
                if (selected.length === 0) {
                    textElement.textContent = 'Select...';
                } else if (selected.length === 1) {
                    textElement.textContent = selected[0];
                } else {
                    textElement.textContent = selected.length + ' selected';
                }
            },
            
            renderVerses: function() {
                var html = '';
                
                AppState.verses.forEach(function(verse) {
                    var deityTags = verse.deities.map(function(deity) {
                        return '<span class="deity">' + deity + '</span>';
                    }).join('');
                    
                    var directionTags = verse.directions.map(function(direction) {
                        return '<span class="direction">' + direction + '</span>';
                    }).join('');
                    
                    var bodyTags = verse.bodyParts.map(function(bodyPart) {
                        return '<span class="body-part">' + bodyPart + '</span>';
                    }).join('');
                    
                    html += 
                        '<div class="verse" data-verse-number="' + verse.number + '">' +
                            '<div class="verse-number">' + verse.number + '</div>' +
                            '<div class="sanskrit">' + verse.sanskrit + '</div>' +
                            '<div class="transliteration">' + verse.transliteration + '</div>' +
                            '<div class="translation">' + verse.translation + '</div>' +
                            '<div class="deities">' + deityTags + directionTags + bodyTags + '</div>' +
                        '</div>';
                });
                
                this.elements.versesContainer.innerHTML = html;
            },
            
            handleSearch: function() {
                var searchTerm = this.elements.searchInput.value.toLowerCase();
                this.showAutocomplete(searchTerm);
                this.filterVerses(searchTerm);
            },
            
            showAutocomplete: function(searchTerm) {
                if (searchTerm.length < 1) {
                    this.elements.autocompleteDropdown.classList.add('hidden');
                    return;
                }
                
                var matches = AppState.searchableItems.filter(function(item) {
                    return item.text.toLowerCase().indexOf(searchTerm) !== -1;
                }).slice(0, 8);
                
                if (matches.length === 0) {
                    this.elements.autocompleteDropdown.classList.add('hidden');
                    return;
                }
                
                var html = matches.map(function(item) {
                    return '<div class="autocomplete-item" data-text="' + item.text + '" data-type="' + item.type + '">' +
                        '<span class="' + item.type + '-name">' + item.text + '</span>' +
                        '<span class="autocomplete-type">' + item.type + '</span>' +
                        '</div>';
                }).join('');
                
                this.elements.autocompleteDropdown.innerHTML = html;
                this.elements.autocompleteDropdown.classList.remove('hidden');
                
                var self = this;
                this.elements.autocompleteDropdown.querySelectorAll('.autocomplete-item').forEach(function(item) {
                    item.addEventListener('click', function() {
                        var searchTerm = this.dataset.text;
                        var itemType = this.dataset.type;
                        
                        self.elements.searchInput.value = '';
                        self.elements.autocompleteDropdown.classList.add('hidden');
                        
                        // Add to filters instead of just search
                        self.addFilterTag(itemType, searchTerm);
                        
                        self.handleSearch();
                    });
                });
            },
            
            addFilterTag: function(type, value) {
                var pluralType = type === 'deity' ? 'deities' : 
                                type === 'direction' ? 'directions' : 
                                type === 'body' ? 'body' : type;
                
                // Add to state
                var selectedArray = AppState['selected' + pluralType.charAt(0).toUpperCase() + pluralType.slice(1)];
                if (selectedArray.indexOf(value) === -1) {
                    selectedArray.push(value);
                }
                
                // Update checkbox in dropdown
                this.selectInDropdown(type, value);
                
                // Update UI
                this.updateFilterTags();
                this.updateHighlights();
            },
            
            removeFilterTag: function(type, value) {
                var pluralType = type === 'deity' ? 'deities' : 
                                type === 'direction' ? 'directions' : 
                                type === 'body' ? 'body' : type;
                
                // Remove from state
                var selectedArray = AppState['selected' + pluralType.charAt(0).toUpperCase() + pluralType.slice(1)];
                var index = selectedArray.indexOf(value);
                if (index !== -1) {
                    selectedArray.splice(index, 1);
                }
                
                // Update checkbox in dropdown
                var container = this.elements[pluralType + 'DropdownContent'];
                if (container) {
                    var checkbox = container.querySelector('[data-value="' + value + '"] .dropdown-checkbox');
                    if (checkbox) {
                        checkbox.checked = false;
                    }
                }
                
                // Update UI
                this.updateFilterTags();
                this.updateDropdownLabels();
                this.updateHighlights();
            },
            
            updateFilterTags: function() {
                var html = '';
                var self = this;
                
                AppState.selectedDeities.forEach(function(deity) {
                    html += '<div class="filter-tag deity-tag">' +
                        '<span>' + deity + '</span>' +
                        '<span class="filter-tag-close" data-type="deity" data-value="' + deity + '">√ó</span>' +
                        '</div>';
                });
                
                AppState.selectedDirections.forEach(function(direction) {
                    html += '<div class="filter-tag direction-tag">' +
                        '<span>' + direction + '</span>' +
                        '<span class="filter-tag-close" data-type="direction" data-value="' + direction + '">√ó</span>' +
                        '</div>';
                });
                
                AppState.selectedBodyParts.forEach(function(bodyPart) {
                    html += '<div class="filter-tag body-tag">' +
                        '<span>' + bodyPart + '</span>' +
                        '<span class="filter-tag-close" data-type="body" data-value="' + bodyPart + '">√ó</span>' +
                        '</div>';
                });
                
                this.elements.activeFilters.innerHTML = html;
                
                // Add click handlers to close buttons
                this.elements.activeFilters.querySelectorAll('.filter-tag-close').forEach(function(closeBtn) {
                    closeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        self.removeFilterTag(this.dataset.type, this.dataset.value);
                    });
                });
            },
            
            filterVerses: function(searchTerm) {
                var allVerses = document.querySelectorAll('.verse');
                
                allVerses.forEach(function(verseElement, index) {
                    var verse = AppState.verses[index];
                    var searchableText = [
                        verse.translation,
                        verse.deities.join(' '),
                        verse.directions.join(' '),
                        verse.bodyParts.join(' ')
                    ].join(' ').toLowerCase();
                    
                    if (searchTerm === '' || searchableText.indexOf(searchTerm) !== -1) {
                        verseElement.style.display = 'block';
                        if (searchTerm !== '' && searchableText.indexOf(searchTerm) !== -1) {
                            verseElement.classList.add('highlighted');
                        } else {
                            verseElement.classList.remove('highlighted');
                        }
                    } else {
                        verseElement.style.display = 'none';
                    }
                });
            },
            
            updateTransliterationView: function() {
                if (AppState.showTransliteration) {
                    document.body.classList.add('show-transliteration');
                    this.elements.transliterationCheck.checked = true;
                } else {
                    document.body.classList.remove('show-transliteration');
                    this.elements.transliterationCheck.checked = false;
                }
            },
            
            updateSanskritView: function() {
                if (AppState.showSanskrit) {
                    document.body.classList.add('show-sanskrit');
                    this.elements.sanskritCheck.checked = true;
                } else {
                    document.body.classList.remove('show-sanskrit');
                    this.elements.sanskritCheck.checked = false;
                }
            },
            
            updateHighlights: function() {
                var allVerses = document.querySelectorAll('.verse');
                
                allVerses.forEach(function(verseElement, index) {
                    var verse = AppState.verses[index];
                    
                    // Remove all highlight classes
                    verseElement.classList.remove('highlight-directions', 'highlight-deities', 'highlight-body');
                    
                    // Check if verse should be visible based on filters (OR logic)
                    var shouldShow = true;
                    
                    // If any filters are active, default to hide unless matches are found
                    if (AppState.selectedDirections.length > 0 || 
                        AppState.selectedDeities.length > 0 || 
                        AppState.selectedBodyParts.length > 0) {
                        shouldShow = false;
                        
                        // Show if verse matches ANY selected filter (OR logic)
                        if (AppState.selectedDirections.length > 0) {
                            var hasMatchingDirection = verse.directions.some(function(dir) { 
                                return AppState.selectedDirections.indexOf(dir) !== -1; 
                            });
                            if (hasMatchingDirection) shouldShow = true;
                        }
                        
                        if (AppState.selectedDeities.length > 0) {
                            var hasMatchingDeity = verse.deities.some(function(deity) { 
                                return AppState.selectedDeities.indexOf(deity) !== -1; 
                            });
                            if (hasMatchingDeity) shouldShow = true;
                        }
                        
                        if (AppState.selectedBodyParts.length > 0) {
                            var hasMatchingBodyPart = verse.bodyParts.some(function(part) { 
                                return AppState.selectedBodyParts.indexOf(part) !== -1; 
                            });
                            if (hasMatchingBodyPart) shouldShow = true;
                        }
                    }
                    
                    // Show/hide verse based on filters
                    if (shouldShow) {
                        verseElement.style.display = 'block';
                        
                        // Apply highlights for matching categories
                        if (AppState.selectedDirections.length > 0 && 
                            verse.directions.some(function(dir) { return AppState.selectedDirections.indexOf(dir) !== -1; })) {
                            verseElement.classList.add('highlight-directions');
                        }
                        if (AppState.selectedDeities.length > 0 && 
                            verse.deities.some(function(deity) { return AppState.selectedDeities.indexOf(deity) !== -1; })) {
                            verseElement.classList.add('highlight-deities');
                        }
                        if (AppState.selectedBodyParts.length > 0 && 
                            verse.bodyParts.some(function(part) { return AppState.selectedBodyParts.indexOf(part) !== -1; })) {
                            verseElement.classList.add('highlight-body');
                        }
                    } else {
                        verseElement.style.display = 'none';
                    }
                });
            },
            
            clearAllFilters: function() {
                // Clear search
                this.elements.searchInput.value = '';
                
                // Clear all checkboxes in dropdowns
                document.querySelectorAll('.dropdown-checkbox').forEach(function(checkbox) {
                    checkbox.checked = false;
                });
                
                // Clear filter tags
                this.elements.activeFilters.innerHTML = '';
                
                // Update dropdown labels
                this.updateDropdownLabels();
                
                // Clear highlights and show all verses
                var allVerses = document.querySelectorAll('.verse');
                allVerses.forEach(function(verse) {
                    verse.style.display = 'block';
                    verse.classList.remove('highlighted', 'highlight-directions', 'highlight-deities', 'highlight-body');
                });
                
                // Hide autocomplete and dropdowns
                this.elements.autocompleteDropdown.classList.add('hidden');
                this.closeAllDropdowns();
            },
            
            selectInDropdown: function(type, value) {
                var pluralType = type === 'deity' ? 'deities' : 
                                type === 'direction' ? 'directions' : 
                                type === 'body' ? 'body' : type;
                
                var container = this.elements[pluralType + 'DropdownContent'];
                if (container) {
                    var checkbox = container.querySelector('[data-value="' + value + '"] .dropdown-checkbox');
                    if (checkbox && !checkbox.checked) {
                        checkbox.checked = true;
                    }
                }
            }
        };
        
        // =============================================================================
        // INITIALIZATION
        // =============================================================================
        
        function initApp() {
            AppState.init();
            UI.init();
        }
        
        // Start the app
        initApp();
    </script>
</body>
</html>